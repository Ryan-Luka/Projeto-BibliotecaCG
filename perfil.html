<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Perfil do UsuÃ¡rio - Biblioteca Central de Campina Grande</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; padding: 10px; border-bottom: 1px solid #ddd; }
    .botao {
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      margin-left: 10px;
    }
    .botao[disabled] {
      background: #aaa;
      cursor: not-allowed;
    }
    .status-ok { color: green; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“š Biblioteca Central de Campina Grande</h1>
    <nav id="menu"></nav>
  </header>

  <main>
    <section class="banner">
      <h2>Bem-vindo, <span id="nomeUsuario"></span>!</h2>
      <p>Email cadastrado: <strong id="emailUsuario"></strong></p>
      <br>

      <a href="livros.html" class="botao">ðŸ“š Consultar Livros</a>

      <h3 style="margin-top: 30px;">ðŸ“˜ Meus livros emprestados</h3>
      <ul id="listaEmprestimos"></ul>
      <p id="msg"></p>
    </section>
  </main>

  <footer>
    <p>Â© 2025 Biblioteca Central de Campina Grande</p>
  </footer>

  <script>
    const tipo = localStorage.getItem("tipo");
    const nome = localStorage.getItem("nome");
    const email = localStorage.getItem("email");

    if (tipo !== "usuario" || !nome || !email) {
      alert("Acesso negado! FaÃ§a login primeiro.");
      window.location.href = "login.html";
    }

    document.getElementById("nomeUsuario").textContent = nome;
    document.getElementById("emailUsuario").textContent = email;

    // --- MENU DINÃ‚MICO ---
    const menu = document.getElementById("menu");
    if (tipo === "usuario") {
      menu.innerHTML = `
        <a href="index.html">InÃ­cio</a>
        <a href="livros.html">Livros</a>
        <a href="contato.html">Contato</a>
        <a href="perfil.html" class="ativo">Meu Perfil</a>
        <a href="#" id="logoutLink">ðŸ‘¤ Sair</a>
      `;
    } else if (tipo === "admin") {
      menu.innerHTML = `
        <a href="index.html">InÃ­cio</a>
        <a href="livros.html">Livros</a>
        <a href="admin.html">Painel Admin</a>
        <a href="reservas_admin.html">Reservas</a>
        <a href="devolucoes_admin.html">DevoluÃ§Ãµes</a>
        <a href="#" id="logoutLink">ðŸ‘¤ Sair</a>
      `;
    } else {
      menu.innerHTML = `
        <a href="index.html">InÃ­cio</a>
        <a href="livros.html">Livros</a>
        <a href="cadastro.html">Cadastro</a>
        <a href="contato.html">Contato</a>
        <a href="login.html" id="loginLink">Login</a>
      `;
    }

    const logoutLink = document.getElementById("logoutLink");
    if (logoutLink) {
      logoutLink.addEventListener("click", () => {
        localStorage.setItem("tipo", "");
        localStorage.setItem("nome", "");
        localStorage.setItem("email", "");
        window.location.href = "index.html";
      });
    }

    // ----- LISTAR MEUS LIVROS EMPRESTADOS -----
let emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || [];
let devolucoes = JSON.parse(localStorage.getItem("devolucoes")) || [];
const listaEmprestimos = document.getElementById("listaEmprestimos");

function atualizarEmprestimos() {
  listaEmprestimos.innerHTML = "";

  const meus = emprestimos.filter(e => e.usuario === email);

  if (meus.length === 0) {
    listaEmprestimos.innerHTML = "<p style='color:gray;'>VocÃª nÃ£o possui livros emprestados.</p>";
    return;
  }

  meus.forEach((emp, index) => {
    const li = document.createElement("li");
    li.style.marginBottom = "10px";
    li.innerHTML = `
      <strong>${emp.livro}</strong>
      <button class="botao" data-index="${index}" style="margin-left: 10px;">
        Devolver
      </button>
    `;
    listaEmprestimos.appendChild(li);
  });
}

// --- ENVIAR SOLICITAÃ‡ÃƒO DE DEVOLUÃ‡ÃƒO ---
listaEmprestimos.addEventListener("click", e => {
  if (e.target.tagName === "BUTTON") {
    const i = e.target.getAttribute("data-index");
    const emprestimo = emprestimos.filter(e => e.usuario === email)[i];

    devolucoes.push({
      livro: emprestimo.livro,
      usuario: emprestimo.usuario,
      status: "pendente"
    });

    localStorage.setItem("devolucoes", JSON.stringify(devolucoes));

    alert("SolicitaÃ§Ã£o de devoluÃ§Ã£o enviada!");
  }
});

atualizarEmprestimos();

</script>

  
</body>
</html>
